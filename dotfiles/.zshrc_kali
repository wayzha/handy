alias osvm_init="export OSVM=$(ip route | grep 'via 192.168.119.1' | grep -v '10.11' | cut -d '/' -f 1)"

function osvm_up {
  IP_LAST_PART="0"
  [[ -n $1 ]] && IP_LAST_PART=$1
  osvm_init
  OSVM="$(echo $OSVM | cut -d '.' -f 1-3)"
  OSVM+=".$IP_LAST_PART"
}

function osvm_ssh {
  SSH_USER="student"
  SSH_PORT=2222
  [[ -n $1 ]] && osvm_up $1
  [[ -n $2 ]] && SSH_PORT=$2
  [[ -n $3 ]] && SSH_USER=$3
  echo "ssh connecting to $SSH_USER@$OSVM, port $SSH_PORT"
  ssh $SSH_USER@$OSVM -p $SSH_PORT
}

function osvm_pf {
  RDP_PORT=3800
  [[ -n $1 ]] && osvm_up $1
  [[ -n $2 ]] && RDP_PORT=$2
  echo "Enable local port $RDP_PORT forwards to $OSVM:3389"
  ssh -N -L 0.0.0.0:$RDP_PORT:$OSVM:3389 kali
}

function osvm_rdp {
  [[ -n $1 ]] && osvm_up $1

  rdesktop $OSVM -u Administrator -p lab -r disk:share=$HOME/workspace
}

# update $OSVM's IP address
osvm_init
